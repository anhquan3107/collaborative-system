<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Project Workspace</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
      rel="stylesheet"
    />
    <link href="css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="css/quill.snow.css" rel="stylesheet" />
    <link href="css/project.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container-fluid mt-3">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h3 id="projectTitle">Project: <span id="projectName"></span></h3>
        <div>
          <button id="viewMembersBtn" class="btn btn-sm btn-light border mr-2">
            <i class="fas fa-users text-primary"></i>
            <span id="memberCountBadge">0 Members</span>
          </button>
          <button id="inviteBtn" class="btn btn-sm btn-info">
            Invite Members
          </button>
          <div class="btn-group mr-2">
            <button
              id="pendingInvitationsBtn"
              class="btn btn-sm btn-warning dropdown-toggle"
              type="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <i class="fas fa-envelope mr-1"></i>
              Pending Invites
              <span
                id="pendingInvitationsBadge"
                class="badge badge-light ml-1"
                style="display: none"
                >0</span
              >
            </button>
            <div
              id="pendingInvitationsDropdown"
              class="dropdown-menu dropdown-menu-right shadow"
              style="min-width: 300px; max-height: 400px; overflow-y: auto"
            >
              <div class="p-2 text-center text-muted">
                <small>Loading invitations...</small>
              </div>
            </div>
          </div>
          <button id="saveDocBtn" class="btn btn-sm btn-success">Save</button>
          <button id="createFileBtn" class="btn btn-sm btn-primary">
            New Document
          </button>
        </div>
      </div>

      <div class="workspace">
        <!-- SIDEBAR -->
        <div id="sidebarWrapper">
          <div id="fileList">
            <div class="text-center text-muted">Loading documents...</div>
          </div>

         <div class="mt-auto border-top pt-3">
              <button id="backToDashboardBtn" class="btn btn-outline-secondary btn-block shadow-sm mb-2">
                  <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
              </button>

              <button id="leaveProjectBtn" class="btn btn-outline-danger btn-block shadow-sm">
                  <i class="fas fa-sign-out-alt mr-2"></i> Leave Project
              </button>
          </div>


        </div>
        
        <!-- PLACEHOLDER (SHOW FIRST) -->
        <div id="noDocPlaceholder">Choose a document to start editing</div>

        <!-- EDITOR WRAPPER (HIDDEN UNTIL OPEN DOC) -->
        <div id="editorWrapper">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 id="docTitle">Select a document</h5>
            <div id="editorStatus" class="text-muted small">Not connected</div>
          </div>

          <div id="toolbar-container" class="mb-2 ql-toolbar ql-snow">
            <select class="ql-header">
              <option value="1"></option>
              <option value="2"></option>
              <option value="3"></option>
              <option selected>Body</option>
            </select>

            <select class="ql-size">
              <option value="10px"></option>
              <option value="13px"></option>
              <option value="16px"></option>
              <option value="18px"></option>
              <option value="32px"></option>
              <option value="48px"></option>
            </select>

            <button class="ql-bold"></button>
            <button class="ql-italic"></button>
            <button class="ql-underline"></button>
            <button class="ql-strike"></button>

            <button class="ql-list" value="ordered"></button>
            <button class="ql-list" value="bullet"></button>

            <button class="ql-indent" value="-1"></button>
            <button class="ql-indent" value="+1"></button>

            <button class="ql-blockquote"></button>
            <button class="ql-code-block"></button>
            <button class="ql-link"></button>

            <button class="ql-clean"></button>
          </div>

          <div id="editor-container"></div>

          <div class="mt-2">
            <small class="text-muted" id="lastSaved">Last saved: Never</small>
          </div>
        </div>
            <div id="whiteboardWrapper" style="display: none; flex: 1; flex-direction: column;">
              <div id="whiteboard-toolbar" class="mb-2 d-flex align-items-center flex-wrap">

        <button id="toolBrush" class="btn btn-sm btn-light border mr-1">
            <i class="fas fa-paint-brush"></i>
        </button>

        <button id="toolEraser" class="btn btn-sm btn-light border mr-3">
            <i class="fas fa-eraser"></i>
        </button>

        <div class="mr-3">
            <label class="small mb-0">Size</label>
            <input id="brushSize" type="range" min="1" max="40" value="5" />
        </div>

        <div class="mr-3">
            <label class="small mb-0">Color</label>
            <input id="brushColor" type="color" value="#000000" />
        </div>

        <button id="toolBucket" class="btn btn-sm btn-light border mr-3">
            <i class="fas fa-fill-drip"></i>
        </button>

        <button id="clearBoardBtn" class="btn btn-sm btn-outline-danger ml-auto">
            <i class="fas fa-trash"></i> Clear
        </button>
    </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 id="boardTitle">Select a whiteboard</h5>
            <div id="whiteboardStatus" class="text-muted small">Not connected</div>
        </div>
        
        <div class="border rounded mb-2" style="flex: 1; position: relative;">
            <canvas 
                id="whiteboardCanvas" 
                style="width: 100%; height: 100%; cursor: crosshair;"
            ></canvas>
        </div>
        
        <div class="mt-2">
            <small class="text-muted" id="whiteboardLastSaved">Last saved: Never</small>
        </div>
    </div>
      </div>

    </div>



    <!-- MODALS (unchanged) -->
<div class="modal fade" id="createFileModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Create New</h5>
        <button class="close" data-dismiss="modal">&times;</button>
      </div>

      <div class="modal-body">
        <input id="newFileTitle" class="form-control mb-3" placeholder="Title">

        <select id="newFileType" class="form-control">
          <option value="document">Document</option>
          <option value="whiteboard">Whiteboard</option>
        </select>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button id="createFileSubmit" class="btn btn-primary">Create</button>
      </div>

    </div>
  </div>
</div>

    <div class="modal fade" id="inviteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Invite to Project</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Email Address</label>
              <input type="email" id="inviteEmail" class="form-control" />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-dismiss="modal">
              Cancel
            </button>
            <button id="inviteSubmit" class="btn btn-primary">
              Send Invitation
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="projectMembersModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Project Team</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="projectMembersList" class="list-group"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script type="module" src="js/pages/project/projectWorkspace.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
  </body>
</html>
